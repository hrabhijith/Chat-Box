<!DOCTYPE html>
<html lang="en">

<head>
  <title>Flask_Chat_App</title>
</head>

<body>
  <nav><button type="button" onclick="window.location.href='{{url_for('logout')}}';">Logout</button></nav>

  <div class="row">
    {% if messages %}
    <br>
    <div class="col-md-6">
      {% for i in messages %}
      <div>
        <p>{{ i.username }} - {{ i.message }}</p>
      </div>
      <br>
      {% endfor %}
      <div class="messageContainer">

      </div>
    </div>
    {% endif %}

    <br>
    <div class="col-md-6">
      <ul>
        {% for i in users %}
        {{i.username}} - <i>{{i.name}}</i>
        {% endfor %}
      </ul>
    </div>
  </div>

  {% if not messages %}
  <div class="row">
    <div class="col-md-6">
      <h3 style='color: #ccc;font-size: 30px;'>No message yet!</h3>
    </div>
  </div>

  {% endif %}

  <form action="" method="POST">
    <input type="text" class="message" placeholder="Messages" />
    <input type="submit" />
  </form>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>


  <script type="text/javascript">
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('connect', function () {
      var form = $('form').on('submit', function (e) {
        e.preventDefault()
        let user_input = $('input.message').val()
        socket.emit('my event', {
          message: user_input
        })
        $('input.message').val('').focus()
      })
    })
    socket.on('my response', function (msg) {
      console.log(msg)


      $('.messageContainer').append("<p>" + msg.username + " - " + msg.message + "</p><br>");

    })
    
  </script>
</body>

</html>